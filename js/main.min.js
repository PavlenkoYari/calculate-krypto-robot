window.addEventListener("DOMContentLoaded",e=>{const t={prices:{},miningPerHour:(e=0,a)=>{const o={json:!0,code:"kryptonstake",table:"accounts",scope:"kryptonstake",limit:"10000"};return a&&(o.lower_bound=a),fetch("https://wax.eosphere.io/v1/chain/get_table_rows",{method:"POST",body:JSON.stringify(o)}).then(e=>e.json()).then(a=>{const o=a.rows.reduce((e,t)=>e+=Number(t.mining_power),e);return a.more?t.miningPerHour(o,a.next_key):(document.getElementById("mining_per_hour").innerHTML=`<span style="text-decoration: none">1 Mining power:</span>${13541/o} Cube/hr`,13541/o)})},getCubePrice:e=>fetch("https://wax.alcor.exchange/api/markets/296").then(e=>e.json()).then(t=>{return document.getElementById("cube_price").innerHTML=`<span>Cube Price:</span>${t.last_price} WAX / ${t.last_price*e} USD`,t.last_price}),getKryptonPrice:e=>fetch("https://wax.alcor.exchange/api/markets/297").then(e=>e.json()).then(t=>{return document.getElementById("krypton_price").innerHTML=`<span>Krypton Price:</span>${t.last_price} WAX / ${t.last_price*e} USD`,t.last_price}),getPrices:()=>fetch("https://api.coingecko.com/api/v3/simple/price?ids=wax&vs_currencies=usd").then(e=>e.json()).then(e=>{const a=e.wax.usd;return document.getElementById("wax_price").innerHTML=`<span>WAX Price:</span>${a} USD`,Promise.all([t.miningPerHour(),t.getCubePrice(a),t.getKryptonPrice(a)]).then(e=>{document.querySelector(".loader").remove();const[o,n,s]=e;return t.prices={waxPrice:a,cubePrice:o,kryptonPrice:n,miningPerHour:s},t.getFactionRanks(),{waxPrice:a,cubePrice:o,kryptonPrice:n,miningPerHour:s}})}),getFactionRanks:(e={titan:[],asteria:[],chaos:[]},a)=>{const o={json:!0,code:"kryptonmissn",table:"atksmission",scope:"kryptonmissn",limit:"10000"};a&&(o.lower_bound=a),fetch("https://wax.eosphere.io/v1/chain/get_table_rows",{method:"POST",body:JSON.stringify(o)}).then(e=>e.json()).then(a=>{const o=a.rows.reduce((e,t)=>("Titan"===t.race&&(e.titan=[...e.titan,t]),"Astraea"===t.race&&(e.asteria=[...e.asteria,t]),"Chaos"===t.race&&(e.chaos=[...e.chaos,t]),e),e);if(a.more)return t.getFactionRanks(o,a.next_key);const n={titan:{color:"rgb(253, 18, 73)",name:"Titan"},chaos:{color:"rgb(206, 0, 255)",name:"Chaos"},asteria:{color:"rgb(58, 175, 252)",name:"Asteria"}};Object.keys(o).forEach(e=>{const t=document.getElementById(e);t.insertAdjacentHTML("beforeend",`<div class="sticky faction__table_title" style="color: ${n[e].color}">${n[e].name}</div>`),t.insertAdjacentHTML("beforeend",'<div class="sticky faction__table_row"><div class="faction__table_cell">Rank</div><div class="faction__table_cell">User</div><div class="faction__table_cell">Mission score</div></div>')}),Object.keys(o).map(e=>{const t=document.getElementById(e);o[e].sort((e,t)=>t.atk_power-e.atk_power).forEach((e,a)=>{t.insertAdjacentHTML("beforeend",`<div class="faction__table_row"><div class="faction__table_cell">${a+1}</div><div class="faction__table_cell">${e.user}</div><div class="faction__table_cell">${e.atk_power}</div></div>`)})})})},getStamina:()=>{fetch("https://wax.eosphere.io/v1/chain/get_table_rows",{method:"POST",body:JSON.stringify({json:!0,code:"kryptonasset",table:"assetsinfos",scope:"kryptonasset",limit:"1",lower_bound:document.querySelector(".calculator__form.stamina .form .form__group_field[name='asset_id']").value})}).then(e=>e.json()).then(e=>{const t=document.getElementById("staminaInfo"),[a]=e.rows;if(!a){document.querySelector(".calculator__form.stamina .form .form__group_field[name='asset_id']").value="";let e="";return e+='<p class="calculator__result_item">Stamina info: <span>0/0/span></p>',e+='<p class="calculator__result_item">HP info: <span>0/0</span></p>',t.innerHTML=e,alert("Nothing not found")}document.querySelector(".calculator__form.stamina .form .form__group_field[name='asset_id']").value=a.asset_id;let o="";o+=`<p class="calculator__result_item">Stamina info: <span>${a.stamina_remain}/${a.stamina}</span></p>`,o+=`<p class="calculator__result_item">HP info: <span>${a.hp_remain}/${a.hp}</span></p>`,t.innerHTML=o}).catch(()=>alert("Nothing not found"))},getStaminaHandler:()=>{$(".calculator__form.stamina .form__submit").click(()=>{t.getStamina()})},getUserInfo:e=>{fetch("https://wax.eosphere.io/v1/chain/get_table_rows",{method:"POST",body:JSON.stringify({json:!0,code:"kryptonmissn",table:"atksmission",scope:"kryptonmissn",limit:"1",lower_bound:document.querySelector(".calculator__form.userStatistic .form .form__group_field[name='playermission']").value,upper_bound:document.querySelector(".calculator__form.userStatistic .form .form__group_field[name='playermission']").value})}).then(e=>e.json()).then(t=>{const[a]=t.rows;if(!a){const e=document.getElementById("user_info");document.querySelector(".calculator__form.userStatistic .form .form__group_field[name='playermission']").value="";let t="";return t+='<p class="calculator__result_item">Wallet address: <span>N/A</span></p>',t+='<p class="calculator__result_item">User race: <span>N/A</span></p>',t+='<p class="calculator__result_item">Mining power, Cube: <span>0</span></p>',t+='<p class="calculator__result_item">Attack power: <span>0</span></p>',t+='<p class="calculator__result_item">Mission score: <span>0</span></p>',e.innerHTML=t,alert("Nothing not found")}fetch("https://wax.eosphere.io/v1/chain/get_table_rows",{method:"POST",body:JSON.stringify({json:!0,code:"kryptonstake",table:"accounts",scope:"kryptonstake",limit:"1",lower_bound:e,upper_bound:e})}).then(e=>e.json()).then(e=>{const[t]=e.rows;if(!t){const e=document.getElementById("user_info");document.querySelector(".calculator__form.userStatistic .form .form__group_field[name='playermission']").value="";let t="";return t+='<p class="calculator__result_item">Wallet address: <span>N/A</span></p>',t+='<p class="calculator__result_item">User race: <span>N/A</span></p>',t+='<p class="calculator__result_item">Mining power, Cube: <span>0</span></p>',t+='<p class="calculator__result_item">Attack power: <span>0</span></p>',t+='<p class="calculator__result_item">Mission score: <span>0</span></p>',e.innerHTML=t,alert("Nothing not found")}const o=document.getElementById("user_info");let n="";n+=`<p class="calculator__result_item">Wallet address: <span>${a.user}</span></p>`,n+=`<p class="calculator__result_item">User race: <span>${a.race}</span></p>`,n+=`<p class="calculator__result_item">Mining power, Cube: <span>${t.mining_power}</span></p>`,n+=`<p class="calculator__result_item">Attack power: <span>${t.attack_power}</span></p>`,n+=`<p class="calculator__result_item">Mission score: <span>${a.atk_power}</span></p>`,o.innerHTML=n}).catch(()=>alert("Nothing not found"))})},getUserInfoHandler:()=>{$(".calculator__form.userStatistic .form__submit").click(()=>{t.getUserInfo()})},calculate:(e=720)=>{const{waxPrice:a,cubePrice:o,kryptonPrice:n,miningPerHour:s}=t.prices,r=document.querySelector(".calculator__form.calculator .form .form__group_field[name='common']").value||0,l=document.querySelector(".calculator__form.calculator .form .form__group_field[name='silver']").value||0,c=document.querySelector(".calculator__form.calculator .form .form__group_field[name='gold']").value||0,i=document.querySelector(".calculator__form.calculator .form .form__group_field[name='commona']").value||0,p=document.querySelector(".calculator__form.calculator .form .form__group_field[name='silvera']").value||0,_=document.querySelector(".calculator__form.calculator .form .form__group_field[name='golda']").value||0,u={income:{cube:{common:1,silver:1.3,gold:3}},expense:{cube:{common:.1875,silver:.1429,gold:.1},krypton:{common:.009375,silver:.007,gold:.005}}},m={expense:{cube:{common:.1875,silver:.15,gold:.107},krypton:{common:.009375,silver:.0075,gold:.00535}}},d=r*u.expense.cube.common+l*u.expense.cube.silver+c*u.expense.cube.gold,f=i*m.expense.cube.common+p*m.expense.cube.silver+_*m.expense.cube.gold,g=r*u.expense.krypton.common+l*u.expense.krypton.silver+c*u.expense.krypton.gold,h=i*m.expense.krypton.common+p*m.expense.krypton.silver+_*m.expense.krypton.gold,y=document.getElementById("expense_all");let b="";b+=`<p class="calculator__result_item"><span style="font-weight: bold;">Cube</span> cost: <span>${((d+f)*e).toFixed(4)}</span></p>`,b+=`<p class="calculator__result_item"><span style="font-weight: bold;">Krypton</span> cost: <span>${((g+h)*e).toFixed(4)}</span></p>`,b+=`<p class="calculator__result_item"><span style="font-weight: bold;">WAX</span> cost: <span>${(((g+h)*n+(d+f)*o)*e).toFixed(4)}</span></p>`,b+=`<p class="calculator__result_item"><span style="font-weight: bold;">USD</span> cost: <span>${(((g+h)*n+(d+f)*o)*a*e).toFixed(4)}</span></p>`,y.innerHTML=b;const w=document.getElementById("expense_miner");let v="";v+=`<p class="calculator__result_item"><span style="font-weight: bold;">Cube</span> cost: <span>${(d*e).toFixed(4)} </span></p>`,v+=`<p class="calculator__result_item"><span style="font-weight: bold;">Krypton</span> cost: <span>${(g*e).toFixed(4)} </span></p>`,v+=`<p class="calculator__result_item"><span style="font-weight: bold;">WAX</span> cost: <span>${(d*o*e+g*n*e).toFixed(4)}</span></p>`,v+=`<p class="calculator__result_item"><span style="font-weight: bold;">USD</span> cost: <span>${((d*o*e+g*n*e)*a).toFixed(4)}</span></p>`,w.innerHTML=v;const k=document.getElementById("expense_attaker");let x="";x+=`<p class="calculator__result_item"><span style="font-weight: bold;">Cube</span> cost: <span>${(f*e).toFixed(4)}</span></p>`,x+=`<p class="calculator__result_item"><span style="font-weight: bold;">Krypton</span> cost: <span>${(h*e).toFixed(4)}</span></p>`,x+=`<p class="calculator__result_item"><span style="font-weight: bold;">WAX</span> cost: <span>${(f*o*e+h*n*e).toFixed(4)}</span></p>`,x+=`<p class="calculator__result_item"><span style="font-weight: bold;">USD</span> cost: <span>${((f*o*e+h*n*e)*a).toFixed(4)}</span></p>`,k.innerHTML=x;const S=(r*u.income.cube.common*s+l*u.income.cube.silver*s+c*u.income.cube.gold*s)*o-o*(d+f)-n*(g+h),$=S*a,P=document.getElementById("income");let T="";T+=`<p class="calculator__result_item"><span style="font-weight: bold;">Cube</span> income: <span>${(s*e).toFixed(4)}</span></p>`,T+=`<p class="calculator__result_item"><span style="font-weight: bold;">WAX</span> income: <span>${S*e}</span></p>`,T+=`<p class="calculator__result_item"><span style="font-weight: bold;">USD</span> income: <span>${$*e}</span></p>`,P.innerHTML=T},calculateHandler:()=>{$(".calculator__form.calculator .form__group_field").keyup(()=>{t.calculate()}),$(".calculator__result.calculator .calculator__result_action_btn").click(e=>{const a=$(e.currentTarget);console.log(a.data("")),console.log(a.data("date-range")),"hour"===a.data("dateRange")&&t.calculate(1),"day"===a.data("dateRange")&&t.calculate(24),"month"===a.data("dateRange")&&t.calculate(720),$(".calculator__result.calculator .calculator__result_action_btn").removeClass("active"),a.addClass("active")})},loaderText:()=>{const e=["Smile more often, it will save the world","The robots are coming. Watch your back","Be calm and just enjoy","If not today, then when?","It's just the word 'CAT'","The universe sees everything","Look forward. The gears are spinning","Robots are one piece. Be whole, be robot!","Robot like a exchange rate, you never know when to collapse"],a=e[Math.floor(Math.random()*(e.length+1))];if(!a)return t.loaderText();document.querySelector(".loader .loader__text").innerHTML=a}};t.loaderText(),t.getPrices(),t.calculateHandler(),t.getUserInfoHandler(),t.getStaminaHandler()});